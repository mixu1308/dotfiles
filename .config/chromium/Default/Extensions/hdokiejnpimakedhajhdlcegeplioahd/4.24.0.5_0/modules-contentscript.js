(function(){"use strict";var e,t,r,i=this;!function(i){var o,n,s,a,c={},u={},l={},p={},d=Object.prototype.hasOwnProperty,f=[].slice,m=/\.js$/;function v(e,t){return d.call(e,t)}function y(e,t){var r,i,o,n,s,a,c,u,p,d,f,v=t&&t.split("/"),y=l.map,h=y&&y["*"]||{};if(e){for(s=(e=e.split("/")).length-1,l.nodeIdCompat&&m.test(e[s])&&(e[s]=e[s].replace(m,"")),"."===e[0].charAt(0)&&v&&(e=v.slice(0,v.length-1).concat(e)),p=0;p<e.length;p++)if("."===(f=e[p]))e.splice(p,1),p-=1;else if(".."===f){if(0===p||1===p&&".."===e[2]||".."===e[p-1])continue;p>0&&(e.splice(p-1,2),p-=2)}e=e.join("/")}if((v||h)&&y){for(p=(r=e.split("/")).length;p>0;p-=1){if(i=r.slice(0,p).join("/"),v)for(d=v.length;d>0;d-=1)if((o=y[v.slice(0,d).join("/")])&&(o=o[i])){n=o,a=p;break}if(n)break;!c&&h&&h[i]&&(c=h[i],u=p)}!n&&c&&(n=c,a=u),n&&(r.splice(0,a,n),e=r.join("/"))}return e}function h(e,t){return function(){var r=f.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),n.apply(i,r.concat([e,t]))}}function g(e){return function(t){c[e]=t}}function b(e){if(v(u,e)){var t=u[e];delete u[e],p[e]=!0,o.apply(i,t)}if(!v(c,e)&&!v(p,e))throw new Error("No "+e);return c[e]}function S(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function w(e){return e?S(e):[]}s=function(e,t){var r,i,o=S(e),n=o[0],s=t[1];return e=o[1],n&&(r=b(n=y(n,s))),n?e=r&&r.normalize?r.normalize(e,(i=s,function(e){return y(e,i)})):y(e,s):(n=(o=S(e=y(e,s)))[0],e=o[1],n&&(r=b(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:r}},a={require:function(e){return h(e)},exports:function(e){var t=c[e];return void 0!==t?t:c[e]={}},module:function(e){return{id:e,uri:"",exports:c[e],config:(t=e,function(){return l&&l.config&&l.config[t]||{}})};var t}},o=function(e,t,r,o){var n,l,d,f,m,y,S,_=[],F=typeof r;if(y=w(o=o||e),"undefined"===F||"function"===F){for(t=!t.length&&r.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if("require"===(l=(f=s(t[m],y)).f))_[m]=a.require(e);else if("exports"===l)_[m]=a.exports(e),S=!0;else if("module"===l)n=_[m]=a.module(e);else if(v(c,l)||v(u,l)||v(p,l))_[m]=b(l);else{if(!f.p)throw new Error(e+" missing "+l);f.p.load(f.n,h(o,!0),g(l),{}),_[m]=c[l]}d=r?r.apply(c[e],_):void 0,e&&(n&&n.exports!==i&&n.exports!==c[e]?c[e]=n.exports:d===i&&S||(c[e]=d))}else e&&(c[e]=r)},e=t=n=function(e,t,r,c,u){if("string"==typeof e)return a[e]?a[e](t):b(s(e,w(t)).f);if(!e.splice){if((l=e).deps&&n(l.deps,l.callback),!t)return;t.splice?(e=t,t=r,r=null):e=i}return t=t||function(){},"function"==typeof r&&(r=c,c=u),c?o(i,e,t,r):setTimeout(function(){o(i,e,t,r)},4),n},n.config=function(e){return n(e)},e._defined=c,(r=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),v(c,e)||v(u,e)||(u[e]=[e,t,r])}).amd={jQuery:!0}}();var o,n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(o,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,i,o,n,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},c=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(n<3?o(s):n>3?o(t,r,s):o(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},u=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});r("common/services/form-detection/form-profile",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/services/form-detection/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/enums/auto-fill-action",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillAction||(t.AutoFillAction={})).Login="Login",r.Email="Email",r.Address="Address",r.PersonalName="PersonalName"}),r("common/enums/auto-fill-input-category",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillInputCategory||(t.AutoFillInputCategory={})).Name="name",r.FullName="fullName",r.FirstName="firstName",r.LastName="lastName",r.Address="address",r.Email="email",r.Password="password",r.UserName="userName"}),r("common/enums/auto-fill-method",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillAlgorithm||(t.AutoFillAlgorithm={})).Legacy="Legacy",r.Euclidean="Euclidean"}),r("common/enums/feature-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.FeatureType||(t.FeatureType={})).AngularFrontendEnabled="angularFrontendEnabled",r.AutoFillControl="autofill_control",r.AutoFillTest="autofill_test",r.BetterGeneratePasswordEnabled="better_generate_password_enabled",r.Block30="block_3_0",r.EmergencyAccessRestricted="emergency_access_restricted",r.FamiliesEnabled="families_enabled",r.FamilyLegacySharedFoldersEnabled="family_legacy_shared_folders_enabled",r.FamilySharedFoldersEnabled="family_shared_folders_enabled",r.FormfillMigration="formfill_migration",r.Freamon="freamon",r.HealthMonitoring="health_monitoring",r.ICOB="icob",r.IntroTutorialVersion="intro_tutorial_version",r.IsDogfood="isDogfood",r.IsInfieldEnabled="is_infield_enabled",r.IsMobileActive="is_mobile_active",r.NewSaveSite="new_save_site",r.OmarDrawer="omardrawer",r.OmarIa="omaria",r.OmarInfieldB="omar_infield_b",r.OmarInfieldC="omar_infield_c",r.OneToOneSharingRestricted="one_to_one_sharing_restricted",r.PasswordSubmittedEvent="password_submitted_event",r.Pdkdf2IterationsMigration="pbkdf2_iterations_migration",r.Retire30="retire_3_0",r.SaveASiteGeneratePasswordsFearlessly="save_a_site_generate_passwords_fearlessly",r.TryFamiliesEnabled="try_families_enabled",r.TutorialEnabled="tutorial_enabled",r.Ziggy="ziggy"}),r("common/enums/repository-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.RepositoryType||(t.RepositoryType={})).Feature="Feature",r.AutoFillState="AutoFillState"}),r("common/enums/resolver-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ResolverType||(t.ResolverType={})).PasswordSubmitted="Password Submitted",r.InjectedPasswordSubmitted="Injected Password Submitted"}),r("common/enums/save-site-action",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.SaveSiteAction||(t.SaveSiteAction={})).Add="Add",r.OK="OK",r.Update="Update",r.NotNow="Not Now",r.Undo="Undo",r.Never="Never"}),r("common/enums/save-site-event-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.SaveSiteDialogEventType||(t.SaveSiteDialogEventType={})).SaveSiteDialogAction="Save a Site Action Clicked",r.SaveSiteDialogDuplicateDeleteClicked="Save a Site Duplicate Delete Clicked",r.SaveSiteDialogDuplicateKeepClicked="Save a Site Duplicate Keep Clicked",r.SaveSiteDialogEditClicked="Save a Site Edit Clicked",r.SaveSiteDialogNewClicked="Save a Site New Clicked",r.SaveSiteDialogSelectClicked="Save a Site Select Clicked",r.SaveSiteDialogViewed="Save a Site Viewed"}),r("common/enums/segment-event-type",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),(t.SegmentEventType||(t.SegmentEventType={})).SaveSiteDialog="savesitedialog"}),r("common/enums/service-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ServiceType||(t.ServiceType={})).BasicAuth="BasicAuth",r.ContentScriptTools="ContentScriptTools",r.DomUtils="DomUtils",r.FormDetection="FormDetection",r.AutoFill="AutoFill",r.FormParser="FormParser",r.Segment="Segment",r.Site="Site",r.StringUtils="StringUtils",r.Topic="Topic",r.WebRequest="WebRequest",r.WebRequestShim="WebRequestShim"}),r("common/enums/topic-type",["require","exports","common/legacy"],function(e,t,r){var i;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.TopicType||(t.TopicType={}))[i.ClearData=r.LegacyGlobalCommon.Topics.CLEAR_DATA]="ClearData",i[i.FilledGeneratedPassword=r.LegacyGlobalCommon.Topics.FILLED_GENERATED_PW]="FilledGeneratedPassword",i[i.Initialized=r.LegacyGlobalCommon.Topics.INITIALIZED]="Initialized",i[i.Login=r.LegacyGlobalCommon.Topics.LOGIN]="Login",i[i.LoginFinished=r.LegacyGlobalCommon.Topics.LOGIN_FINISHED]="LoginFinished",i[i.ProcessedFormSubmit=r.LegacyGlobalCommon.Topics.PROCESSED_FORM_SUBMIT]="ProcessedFormSubmit",i[i.RequestFrameworkInitialized=r.LegacyGlobalCommon.Topics.REQUEST_FRAMEWORK_INITIALIZED]="RequestFrameworkInitialized"}),r("common/enums/index",["require","exports","common/enums/auto-fill-action","common/enums/auto-fill-input-category","common/enums/auto-fill-method","common/enums/feature-type","common/enums/repository-type","common/enums/resolver-type","common/enums/save-site-action","common/enums/save-site-event-type","common/enums/segment-event-type","common/enums/service-type","common/enums/topic-type"],function(e,t,r,i,o,n,s,a,c,u,l,p,d){function f(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),f(r),f(i),f(o),f(n),f(s),f(a),f(c),f(u),f(l),f(p),f(d)}),r("common/repositories/auto-fill-state/auto-fill-algorithm-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/repositories/auto-fill-state/auto-fill-frame-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/repositories/auto-fill-state/auto-fill-state",["require","exports","common/enums/index"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.tabId=e,this.url=t,this.frames={}}return Object.defineProperty(e.prototype,"isReady",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){var r=e.frames[t];return r.isReady||!r.isAllowed})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAllowed",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){return e.frames[t].isAllowed})},enumerable:!0,configurable:!0}),e.prototype.tryGetFrame=function(e){return this.frames[e]||(this.frames[e]=this.getEmptyFrame()),this.frames[e]},e.prototype.getEmptyFrame=function(){return{elements:{},isAllowed:!0,isReady:!1}},e.prototype.setFrameAllowed=function(e,t){this.tryGetFrame(e).isAllowed=t},e.prototype.setFrameReady=function(e,t){this.tryGetFrame(e).isReady=t},e.prototype.getFrameAlgorithmState=function(e,t,r){var i=this.tryGetFrame(e);if(i.elements[t])return i.elements[t][r]},e.prototype.setFrameAlgorithmState=function(e,t,r,i){var o=this.tryGetFrame(e),s=o.elements[t];s||(s={},o.elements[t]=s),o.elements[t][r]=n({},s[r],i)},e.prototype.resetFrameState=function(e){this.frames[e]&&(this.frames[e]=this.getEmptyFrame())},e.prototype.deleteFrameState=function(e){this.frames[e]&&delete this.frames[e]},e.prototype.getResults=function(){var e=this,t={count:0};Object.keys(r.AutoFillAlgorithm).forEach(function(e){t[e]=0});var i={allowed:this.isAllowed,userName:n({},t),password:n({},t)};return Object.keys(this.frames).forEach(function(o){var s=e.frames[o];s.isAllowed&&s.isReady&&Object.keys(s.elements).forEach(function(e){return Object.keys(s.elements[e]).forEach(function(o){var a=s.elements[e][o].filledWith;if(a&&"none"!==a){i[a]||(i[a]=n({},t));var c=i[a][o]+1;o===r.AutoFillAlgorithm.Legacy&&(i[a].count=c),i[a][o]=c}})})}),i},e}();t.AutoFillState=i}),r("common/repositories/auto-fill-state/index",["require","exports","common/repositories/auto-fill-state/auto-fill-state"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}),r("common/interfaces/auto-fill-state.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/auto-fill.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/feature.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/segment.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/segment-event",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/serializable-callback",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/serializable-value",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/web-request-shim.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/web-request.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/content-script-target",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/services/form-parser/form-meta-data",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.passwordsByValue={},this.textFieldsByValue={},this.textFieldsByType={},this.uniqueTextValues=[],this.uniquePasswords=[],e.fields&&(e.fields.forEach(function(e){"password"===e.type?t.aggregateField(e,e.value,t.passwordsByValue):(t.aggregateField(e,e.value,t.textFieldsByValue),t.aggregateField(e,e.type,t.textFieldsByType))}),this.uniqueTextValues=Object.keys(this.textFieldsByValue),this.uniquePasswords=Object.keys(this.passwordsByValue))}return e.prototype.aggregateField=function(e,t,r){var i=r[t];i?++i.count:r[t]={field:e,count:1}},e}();t.FormMetaData=r}),r("background/interfaces/parsed-form",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyGlobalCommon=i}),r("common/module.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this._isInitialized=!1,this.initializedQueue=[],setTimeout(function(){return s(e,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.initialize()];case 1:return e.sent(),[4,this.postInitialize()];case 2:for(e.sent(),this._isInitialized=!0;this.initializedQueue.length;)try{this.initializedQueue.pop()()}catch(e){console.error(e)}return[2]}})})})}return e.prototype.isInitialized=function(e){this._isInitialized?e():this.initializedQueue.push(e)},e}();t.ModuleAbstract=r}),r("common/provider.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=!0);var r=this;this.instances={},this.initialized=!1,e&&e.size&&(this.map=e,this.map.forEach(function(e,i){e.delegated&&!t||(r.instances[i]=new e.ctor)}))}return e.prototype.initialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){return e.instances[t].initialize()}),this.initialized=!0},e.prototype.postInitialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){"function"==typeof e.instances[t].postInitialize&&e.instances[t].postInitialize()})},e.prototype.teardown=function(){var e=this;Object.keys(this.instances).forEach(function(t){e.instances[t]&&"function"==typeof e.instances[t].destroy&&e.instances[t].destroy()})},e}();t.ProviderAbstract=r}),r("common/decorators/register-repository.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.RegisterRepository=function(e,t){return void 0===t&&(t=!1),function(i){r.set(e,{ctor:i,delegated:t})}},t.getRepositoryRegistry=function(){return r}}),r("common/decorators/register-service.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.RegisterService=function(e,t){return void 0===t&&(t=!1),function(i){r.set(e,{ctor:i,delegated:t})}},t.getServiceRegistry=function(){return r}}),r("common/messaging/messaging",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap;t.addVisibleMethod=function(e,t){var i=e.constructor,o=r.get(i);o&&o.size?o.add(t):o=new Set([t]),r.set(i,o)};var i=null;function o(e,t){if("function"==typeof t){var r=void 0;"string"==typeof e?r=e:e instanceof Error&&(r="string"==typeof e.message?e.message:"function"==typeof e.toString?e.toString():"Unknown error"),t(r)}else console.error(e)}t.getInvokatingMessageContext=function(){return i},t.callMethod=function(e,t,n,c,u){return void 0===n&&(n=[]),s(this,void 0,void 0,function(){var s,l;return a(this,function(a){switch(a.label){case 0:if(a.trys.push([0,3,4,5]),!e||!e.constructor)throw new Error("No target provided!");if(!r.has(e.constructor))throw new Error("Target has no visible methods.");if(!r.get(e.constructor).has(t))throw new Error("Method [ "+t+" ] is not a visible method.");if("function"!=typeof(s=e[t]))throw new Error("Method [ "+t+" ] is not a function or does not exist on the target.");return i=Object.freeze({calleeTab:Object.freeze(u)}),(l=s.bind(e).apply(void 0,n))&&"function"==typeof l.then?[4,l]:[3,2];case 1:l=a.sent(),a.label=2;case 2:return c(null,l),[3,5];case 3:return o(a.sent(),c),[3,5];case 4:return i=null,[7];case 5:return[2]}})})},t.handleCallbackError=o}),r("common/decorators/visible.decorator",["require","exports","common/messaging/messaging"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Visible=function(e,t,i){r.addVisibleMethod(e,t)}}),r("common/decorators/index",["require","exports","common/decorators/register-repository.decorator","common/decorators/register-service.decorator","common/decorators/visible.decorator"],function(e,t,r,i,o){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(i),n(o)}),r("common/interfaces/site.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/services/topic/topic.service",["require","exports","common/decorators/index","common/enums/index","common/legacy"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.subscribe=function(e,t){o.LegacyGlobalCommon.Topics.get(e).subscribe(function(e){return t(e)})},e=c([r.RegisterService(i.ServiceType.Topic)],e)}();t.TopicService=n}),r("common/services/utils/string-utils.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.stringContains=function(e,t){if(e&&t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;++r)if(e.indexOf(t[r])>-1)return!0}return!1},e.prototype.containsMaskingCharacter=function(e){return e.indexOf("*")>-1||e.indexOf(String.fromCharCode(8226))>-1},e=c([r.RegisterService(i.ServiceType.StringUtils)],e)}();t.StringUtilsService=o}),r("content-script/interfaces/content-script-instances-info",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("content-script/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("content-script/services/auto-fill/algorithms/algorithm-result",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("content-script/services/auto-fill/algorithms/algorithm.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.AlgorithmAbstract=r}),r("content-script/services/auto-fill/algorithms/euclidean-distance-algorithm",["require","exports","common/enums/index","common/enums/index","content-script/services/auto-fill/algorithms/algorithm.abstract","content-script/content-script.module"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.autoFillService=n.getService(i.ServiceType.AutoFill),t}return u(t,e),t.prototype.execute=function(e){var r=this,i=Array.from(document.querySelectorAll('input[type="text"], input:not([type]), input[type="password"], input[type="email"]')),o=[],n=new Map;i.forEach(function(e){var i=r.autoFillService.getInputElementData(e);if(i.visible)for(var o=[i.id,i.type,i.ariaLabel,i.name],s=new Map,a=0,c=o;a<c.length;a++){var u=c[a];if(u){var l=r.getFitResults(u,t.inputWords);if(l&&l.matches.length){for(var p=0,d=l.matches;p<d.length;p++){var f=d[p];s.has(f.inputCategory)?s.set(f.inputCategory,s.get(f.inputCategory)+f.confidence):s.set(f.inputCategory,f.confidence)}l.matches.sort(function(e,t){return s.get(t.inputCategory)-s.get(e.inputCategory)});var m=l.matches[0];if(m){var v=void 0;n.has(e)?(v=n.get(e)).bestMatch.inputCategory===m.inputCategory?v.bestMatch.confidence+=m.confidence:n.get(e).bestMatch.confidence<m.confidence&&(v={fitResults:l,bestMatch:m}):v={fitResults:l,bestMatch:m},n.set(e,v)}}}}});var s=new Map;return n.forEach(function(r,i){var n=r.fitResults,a=r.bestMatch;if(e.some(function(e){return e===a.inputCategory})){var c=n.matches[0].confidence>t.FitThreshold&&n.matches[0].confidence-n.matches[1].confidence>t.FitSeparation,u=s.get(a.inputCategory);u&&u.matches[0].confidence>a.confidence||(s.set(a.inputCategory,n),o.push({inputElement:i,inputValue:n.value,inputValueNormalized:n.valueNormalized,category:a.inputCategory,closestMatchingWord:a.closestMatchingWord,isMatching:c,confidence:a.confidence}))}}),o},t.prototype.similarity=function(e,t){var r=e,i=t;e.length<t.length&&(r=t,i=e);var o=r.length;return 0===o?1:(o-this.editDistance(r,i))/o},t.prototype.editDistance=function(e,t){for(var r=Array.from(e.toLowerCase()),i=Array.from(t.toLowerCase()),o=[],n=0;n<=r.length;n++){for(var s=n,a=0;a<=i.length;a++)if(0===n)o[a]=a;else if(a>0){var c=o[a-1];r[n-1]!==i[a-1]&&(c=1+Math.min(Math.min(c,s),o[a])),o[a-1]=s,s=c}n>0&&(o[t.length]=s)}return o[t.length]},t.prototype.normalizeAttributeValue=function(e){return e.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()},t.prototype.findBestMatch=function(e,t,r){for(var i=0,o=null,n=NaN,s=0;s<t.length;s++)(n=this.similarity(t[s],r))>i&&(i=n,o=s);return{inputCategory:e,closestMatchingWord:t[o],confidence:100*Number(i.toFixed(2))}},t.prototype.getFitResults=function(e,t){var r=this,i=this.normalizeAttributeValue(e),o=Object.keys(t).map(function(e){return r.findBestMatch(e,t[e],i)});return o.sort(function(e,t){return t.confidence-e.confidence}),{value:e,valueNormalized:i,matches:o}},t.FitThreshold=80,t.FitSeparation=10,t.inputWords=function(){var e;function t(e,t){var r=[];return e.forEach(function(e){return t.forEach(function(t){return r.push(e+t)})}),r}var i=["first","1st","f","front","head","primary","prime","initial","cardinal","1st","1","proper"],o=["last","end","final","l"],n=["full","whole","entire"],s=["name","n","nombre"],a=["address","addr"],c=["email","e","mailto","emailaddress","useremail","emailuser"],u=["password","pass","pw","p","pwd"],l=["user","uname","username","nameuser","u","accountname"];return(e={})[r.AutoFillInputCategory.Name]=s,e[r.AutoFillInputCategory.FullName]=t(n,s),e[r.AutoFillInputCategory.FirstName]=t(i,s),e[r.AutoFillInputCategory.LastName]=t(o,s),e[r.AutoFillInputCategory.Address]=a,e[r.AutoFillInputCategory.Email]=c,e[r.AutoFillInputCategory.Password]=u,e[r.AutoFillInputCategory.UserName]=l,e}(),t}(o.AlgorithmAbstract);t.EuclideanDistanceAlgorithm=s}),r("content-script/services/auto-fill/algorithms/index",["require","exports","content-script/services/auto-fill/algorithms/euclidean-distance-algorithm"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}),r("content-script/services/auto-fill/post-processors/login-post-processor",["require","exports","common/enums/index"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.loginPostProcess=function(e){if(!e.some(function(e){return e.category===r.AutoFillInputCategory.UserName})){var t=e.filter(function(e){return e.category===r.AutoFillInputCategory.Password}),i=e.filter(function(e){return e.category===r.AutoFillInputCategory.Email});t.length<=1&&1===i.length&&(i[0].category=r.AutoFillInputCategory.UserName)}return e}}),r("content-script/services/auto-fill/auto-fill.service",["require","exports","common/decorators/index","common/enums/index","content-script/services/auto-fill/post-processors/login-post-processor","content-script/services/auto-fill/algorithms/index","content-script/content-script.module"],function(e,t,r,i,o,n,u){var l;Object.defineProperty(t,"__esModule",{value:!0});var p=i.AutoFillAction,d=i.AutoFillInputCategory,f=function(){function e(){}var t;return t=e,e.prototype.initialize=function(){this.contentScriptTools=u.getService(i.ServiceType.ContentScriptTools),this.autoFillStateRepo=u.getRepository(i.RepositoryType.AutoFillState),this.featureRepository=u.getRepository(i.RepositoryType.Feature)},e.prototype.postInitialize=function(){return s(this,void 0,void 0,function(){var e,t,r,o,n,s=this;return a(this,function(a){switch(a.label){case 0:return[4,this.featureRepository.get(i.FeatureType.AutoFillTest)];case 1:return a.sent()?(e=u.getContentScriptInstanceInfo(),t=e.tabId,r=e.frameId,o=e.isTop,"loading"===window.document.readyState?(n=function(e){s.autoFillStateRepo.resetFrameState(t,r),s.fill(i.AutoFillAction.Login),window.removeEventListener("DOMContentLoaded",n)},window.addEventListener("DOMContentLoaded",n)):this.fill(i.AutoFillAction.Login),window.addEventListener("beforeunload",function(e){o?s.autoFillStateRepo.deleteState(t):s.autoFillStateRepo.deleteFrameState(t,r)}),[2]):[2]}})})},e.prototype.getInputElementData=function(e){var t=e.getBoundingClientRect(),r=t.left,i=t.top;return{width:e.width,height:e.height,visible:this.contentScriptTools.isVisible(e),position:{left:r,top:i},id:this.contentScriptTools.getAttribute(e,"id"),type:this.contentScriptTools.getAttribute(e,"type"),name:this.contentScriptTools.getAttribute(e,"name"),value:this.contentScriptTools.getAttribute(e,"value"),ariaLabel:this.contentScriptTools.getAttribute(e,"aria-label"),raw:e}},e.prototype.fill=function(e){var r=(new n.EuclideanDistanceAlgorithm).execute(t.actionInputMap[e]);(e=i.AutoFillAction.Login)&&(r=o.loginPostProcess(r));for(var s=u.getContentScriptInstanceInfo(),a=s.tabId,c=s.frameId,l=0,p=r;l<p.length;l++){var d=p[l],f=void 0;switch(d.category){case i.AutoFillInputCategory.Password:f="password";break;case i.AutoFillInputCategory.UserName:f="userName";break;default:f="other"}this.autoFillStateRepo.setFrameAlgorithmState(a,c,d.inputElement,i.AutoFillAlgorithm.Euclidean,{inputCategory:d.category,elementType:d.inputElement.type,filledWith:f})}},e.actionInputMap=((l={})[p.Login]=[d.Email,d.UserName,d.Password],l[p.Email]=[d.Email],l[p.Address]=[d.Address],l[p.PersonalName]=[d.FullName,d.FirstName,d.LastName],l),c([r.Visible],e.prototype,"fill",null),e=t=c([r.RegisterService(i.ServiceType.AutoFill)],e)}();t.AutoFillService=f}),r("content-script/services/site/delegated-site.service",["require","exports","content-script/services/index","common/enums/index","common/decorators/index"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.getUserNames=function(e){return r.callBackgroundService(i.ServiceType.Site,"getUserNames",[e])},e=c([o.RegisterService(i.ServiceType.Site,!0)],e)}();t.DelegatedSiteService=n}),r("content-script/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("content-script/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyGlobal=i}),r("content-script/services/form-detection/form-detection.service",["require","exports","common/decorators/index","common/enums/index","content-script/content-script.module","content-script/legacy"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){var e=this;this.inputSelector='input:not([type]),input[type="text"],input[type="email"],input[type="password"],input[type="hidden"]',this.inputAttributes=["name","ng-model","data-reactid","id"],this.inputMap=new Map,this.formMap=new Map,this.hasPasswordInput=!1,this.saveSiteDialogIsDisplayed=!1,this.hasGeneratedPasswordSinceLastAutofill=!1,this.mutationCallback=function(t){t.forEach(function(t){var r;if("attributes"===t.type&&(r=t.target)instanceof HTMLInputElement){var i=e.inputMap.get(r);i?i.attributes=e.tools.getAttributes(r,e.inputAttributes):e.addMappedInput(r)}if(t.addedNodes.length||t.removedNodes.length){for(var o=0;o<t.addedNodes.length;++o)(r=t.addedNodes.item(o))instanceof HTMLInputElement?e.addMappedInput(r):r instanceof HTMLFormElement?e.addMappedForm(r):r instanceof HTMLElement&&(e.getInputs(r).forEach(e.addMappedInput),r.innerHTML&&r.innerHTML.includes("contentScriptDialog")&&(e.saveSiteDialogIsDisplayed=!0));for(o=0;o<t.removedNodes.length;++o)(r=t.removedNodes.item(o))instanceof HTMLInputElement?e.removeMappedInput(r):r instanceof HTMLFormElement?e.removeMappedForm(r):r instanceof HTMLElement&&(Array.from(r.querySelectorAll(e.inputSelector)).forEach(e.removeMappedInput),Array.from(r.querySelectorAll("form")).forEach(e.removeMappedForm),r.innerHTML&&r.innerHTML.includes("contentScriptDialog")&&(e.saveSiteDialogIsDisplayed=!1))}}),e.hasPasswordInput=Array.from(e.inputMap.values()).some(function(e){return"password"===e.type})},this.addMappedForm=function(t){t.addEventListener("submit",e.submitListener),e.formMap.has(t)||e.formMap.set(t,e.createFormProfile())},this.removeMappedForm=function(t){e.formMap.delete(t)&&t.removeEventListener("submit",e.submitListener)},this.addMappedInput=function(t){t.addEventListener("change",e.changeListener),t.addEventListener("keydown",e.keydownListener);var r={value:t.value,attributes:e.tools.getAttributes(t,e.inputAttributes),label:e.tools.getElementLabel(t),type:e.getInputType(t)};e.inputMap.set(t,r),e.getFormProfile(t).fields.push(r),e.hasPasswordInput=e.hasPasswordInput||"password"===r.type},this.removeMappedInput=function(t){var r=e.getFormProfile(t),i=e.inputMap.get(t),o=r.fields.indexOf(i);o>-1&&r.fields.splice(o,1),e.inputMap.delete(t)&&(t.removeEventListener("change",e.changeListener),t.removeEventListener("keydown",e.keydownListener))},this.changeListener=function(t){t.isTrusted&&(e.setFieldValue({input:t.target,fromUser:!0}),e.trackForms())},this.keydownListener=function(t){t.isTrusted&&13===(t.keyCode||t.which)&&(e.setFieldValue({input:t.target,fromUser:!0}),e.trackForms())},this.submitListener=function(t){t.isTrusted&&e.trackForms(!0)},this.trackForms=function(t){if(void 0===t&&(t=!1),e.hasPasswordInput){t&&Array.from(e.inputMap.entries()).forEach(function(t){var r=t[0],i=t[1];e.setFieldValue({input:r,field:i})});var r=e.webRequest.isApiSupported()?i.ResolverType.PasswordSubmitted:i.ResolverType.InjectedPasswordSubmitted;e.webRequest.trackFormSubmission(e.csInfo.tabId,Array.from(e.formMap.values()).concat([e.orphansFormProfile]),r)}},this.getInputType=function(t){return"password"===t.type||"disc"===e.tools.getCSS(t,"text-security")?"password":"email"===t.type||"hidden"===t.type?t.type:"text"},this.getInputs=function(t){void 0===t&&(t=document.body);var r=Array.from(t.querySelectorAll(e.inputSelector)),i=[],o=new Map;if(r.forEach(function(t){if(e.tools.isVisible(t))(t.value!==t.getAttribute("value")||t.value.length>1)&&i.push(t);else if(["hidden","text","email"].indexOf(t.type)>-1){var r=o.get(t.value)||{matches:0,inputs:[]};r.inputs.push(t),o.set(t.value,r)}}),o.size){for(var n=o.entries(),s=void 0;!(s=n.next()).done;)s.value[1].inputs.length>1&&o.delete(s.value[0]);for(var a=Array.from(o.keys()),c=document.createTreeWalker(document,NodeFilter.SHOW_TEXT),u=function(){var t=c.currentNode;if(["OPTION","SCRIPT"].some(function(e){return t.parentElement.nodeName===e}))return"continue";var r=t.nodeValue.trim();if(a.some(function(e){return e===r})){if(!e.tools.isVisible(t))return"continue";var i=o.get(r);i.matches++,o.set(r,i)}};c.nextNode();)u();for(n=o.entries();!(s=n.next()).done;)1===s.value[1].matches&&i.push(s.value[1].inputs[0])}return i},this.setFieldValue=function(t){var r=t.input,i=t.field,o=t.fromUser,n=void 0!==o&&o;i=i||e.inputMap.get(r);var s=e.getFormProfile(r),a=r.value;if("password"===i.type)!a||i.dirty||s.originalPassword||(s.originalPassword=i.value);else{if(e.stringUtils.containsMaskingCharacter(a))if(i.value&&i.value!==a&&!e.stringUtils.containsMaskingCharacter(i.value))a=i.value;else{var c=s.fields.filter(function(t){return!(t===i||!t.value||e.stringUtils.containsMaskingCharacter(t.value)||t.value.length!==a.length||t.value[0]!==a[0]&&t.value[t.value.length-1]!==i.value[a.length-1])})[0];c&&(a=c.value)}e.siteUserNames.some(function(e){return e===a})?s.username=a:s.username===i.value&&(s.username=a)}i.dirty=i.dirty||n,i.value=a},this.getFormProfile=function(t){var r;return console.assert(t instanceof HTMLInputElement,"Input argument is not an HTMLInputElement"),t.form?(r=e.formMap.get(t.form))||(r=e.createFormProfile(),e.formMap.set(t.form,r)):r=e.orphansFormProfile,r}}return e.prototype.initialize=function(){var e=this;if(this.siteService=o.getService(i.ServiceType.Site),this.stringUtils=o.getService(i.ServiceType.StringUtils),this.tools=o.getService(i.ServiceType.ContentScriptTools),this.webRequest=o.getService(i.ServiceType.WebRequest),this.csInfo=o.getContentScriptInstanceInfo(),this.features=o.getRepository(i.RepositoryType.Feature),o.getService(i.ServiceType.Topic).subscribe(i.TopicType.FilledGeneratedPassword,function(t){var r=t.element,i=t.password,o=e.getFormProfile(r);o&&o.generatedPassword!==i&&(o.generatedPassword=i,e.handleGeneratedPassword(o))}),"loading"!==document.readyState)this.onDocumentReady();else{var t=function(){e.onDocumentReady(),document.removeEventListener("DOMContentLoaded",t)};document.addEventListener("DOMContentLoaded",t)}},e.prototype.getHasGeneratedPasswordSinceLastAutofill=function(){return this.hasGeneratedPasswordSinceLastAutofill},e.prototype.setHasGeneratedPasswordSinceLastAutofill=function(e){this.hasGeneratedPasswordSinceLastAutofill=e},e.prototype.onDocumentReady=function(){return s(this,void 0,void 0,function(){var e,t=this;return a(this,function(r){switch(r.label){case 0:return this.orphansFormProfile=this.createFormProfile(),this.orphansFormProfile.containsOrphans=!0,e=this,[4,this.siteService.getUserNames(document.location.hostname)];case 1:return e.siteUserNames=r.sent(),this.getInputs().forEach(this.addMappedInput),Array.from(document.querySelectorAll("form")).forEach(this.addMappedForm),window.addEventListener("lprequeststart",function(){return t.trackForms(!0)}),this.observer=new MutationObserver(this.mutationCallback),this.observer.observe(document,{attributes:!0,attributeFilter:this.inputAttributes,childList:!0,subtree:!0}),setTimeout(function(){Array.from(t.inputMap.keys()).forEach(function(e){t.setFieldValue({input:e})})},10),[2]}})})},e.prototype.handleGeneratedPassword=function(e){return s(this,void 0,void 0,function(){var t,r,i;return a(this,function(o){switch(o.label){case 0:return(t=e&&e.generatedPassword)?[4,this.shouldShowPresubmitSaveSiteDialog()]:[3,2];case 1:t=o.sent(),o.label=2;case 2:return t&&(r=e.fields&&e.fields.length?e.fields[0]:null,i=e.fields&&e.fields.length>1?e.fields[1]:null,n.LegacyGlobal.bg.LPTabState.getSiteNotification({url:e.url,usernameField:r,passwordField:i,callback:this.showSaveSiteDialog.bind(this)})),[2]}})})},e.prototype.showSaveSiteDialog=function(e){e.generatedPassword&&e.defaultData&&(e.dialogData.preSubmit=!0,this.hasGeneratedPasswordSinceLastAutofill=!0,n.LegacyGlobal.LPFrame.openDialog("contentScriptSite",e,{css:{top:10,right:10}}))},e.prototype.shouldShowPresubmitSaveSiteDialog=function(){return s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.features.get(i.FeatureType.SaveASiteGeneratePasswordsFearlessly)];case 1:return[2,!!e.sent()&&!this.saveSiteDialogIsDisplayed]}})})},e.prototype.createFormProfile=function(){return{fields:[],top:window===top,url:document.location.hostname}},e=c([r.RegisterService(i.ServiceType.FormDetection)],e)}();t.FormDetectionService=u}),r("content-script/services/segment/delegated-segment.service",["require","exports","common/decorators/index","common/enums/index","content-script/legacy","content-script/services/index"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.send=function(e,t){o.LegacyGlobal.bg.sendLpImprove(e,t)},e.prototype.sendTypedEvent=function(e,t){return n.callBackgroundService(i.ServiceType.Segment,"sendTypedEvent",[e,t])},c([r.Visible],e.prototype,"sendTypedEvent",null),e=c([r.RegisterService(i.ServiceType.Segment,!0)],e)}();t.DelegatedSegmentService=s}),r("content-script/services/service-provider",["require","exports","common/provider.abstract","common/messaging/messaging","content-script/legacy"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.callQueue=[],t}return u(t,e),t.prototype.getService=function(e){return this.instances[e]},t.prototype.initialize=function(){for(e.prototype.initialize.call(this);this.callQueue.length;){var t=this.callQueue.shift(),r=t.serviceType,o=t.method,n=t.args,s=t.callback;i.callMethod(this.getService(r),o,n,s)}},t.prototype.postInitialize=function(){e.prototype.postInitialize.call(this)},t.prototype.teardown=function(){e.prototype.teardown.call(this)},t.prototype.isInitialized=function(){return this.initialized},t.prototype.call=function(e,t,r,o){void 0===r&&(r=[]);try{this.isInitialized()?i.callMethod(this.getService(e),t,r,o):this.callQueue.push({serviceType:e,method:t,args:r,callback:o})}catch(e){i.handleCallbackError(e,o)}},t}(r.ProviderAbstract);t.ServiceProvider=n,t.callBackgroundService=function(e,t,r,i){if("function"!=typeof i)return new Promise(function(i,n){o.LegacyGlobal.bg.LPModule.callService(e,t,r,function(e,t){e?n(e):i(t)})});o.LegacyGlobal.bg.LPModule.callService(e,t,r,i)}}),r("content-script/services/tools/content-script-tools.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.unloading=!1}return e.prototype.initialize=function(){var e=this;window.addEventListener("beforeunload",function(t){!1!==t.isTrusted&&(e.unloading=!0)})},e.prototype.isUnloading=function(){return this.unloading},e.prototype.getCSS=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},e.prototype.getAttributes=function(e,t){var r=this;return t.reduce(function(t,i){return t[i]=r.getAttribute(e,i),t},{})},e.prototype.getAttribute=function(e,t){return e.hasAttribute(t)?e.getAttribute(t):void 0},e.prototype.isForm=function(e){return"FORM"===e.nodeName},e.prototype.getForm=function(e){for(;e;){if(this.isForm(e))return e;e=e.parentElement}return null},e.prototype.isClickable=function(e){if("function"==typeof document.elementFromPoint){var t=e.getBoundingClientRect();return document.elementFromPoint(t.left,t.top)===e||document.elementFromPoint(t.right,t.top)===e||document.elementFromPoint(t.left,t.bottom)===e||document.elementFromPoint(t.right,t.bottom)===e}return!0},e.prototype.isScrollableX=function(e){if(e.scrollWidth>e.clientWidth){var t=this.getCSS(e,"overflow-x");return"auto"===t||"scroll"===t}return!1},e.prototype.isScrollableY=function(e){if(e.scrollHeight>e.clientHeight)switch(this.getCSS(e,"overflow-y")){case"auto":case"scroll":return!0;case"visible":return e===document.body||!e.parentElement}return!1},e.prototype.getViewableArea=function(e){for(var t={top:0,left:0,width:window.innerWidth,height:window.innerHeight},r=e.parentElement;r;)r.scrollLeft>0&&(t.left-=r.scrollLeft),r.scrollTop>0&&(t.top-=r.scrollTop),this.isScrollableX(r)&&(t.width+=r.scrollWidth-r.clientWidth),this.isScrollableY(r)&&(t.height+=r.scrollHeight-r.clientHeight),r=r.parentElement;return t.right=t.left+t.width,t.bottom=t.top+t.height,t},e.prototype.isVisible=function(e){if(!(e&&e instanceof HTMLElement))return!1;if(!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))return!1;var t=e.getBoundingClientRect(),r=this.getViewableArea(e);return!(t.right<r.left||t.bottom<r.top||t.left>r.right||t.top>r.bottom)},e.prototype.getElementLabel=function(e){for(var t=[function(){if(e.getAttribute("id")){var t=document.querySelector('label[for="'+e.getAttribute("id")+'"]');if(t)return t.textContent}return null},function(){for(var t=e;t;){if("LABEL"===t.tagName.toUpperCase())return t.textContent;t=t.parentElement}return null},function(){return e.getAttribute("placeholder")},function(){for(var t=e;t;){var r=t.textContent;if(r){var i=r.split("\n").map(function(e){return e.trim()}).filter(function(e){return e.length>0});if(1===i.length)return i[0];break}t=t.previousSibling||t.parentElement}}],r=0;r<t.length;++r){var i=t[r]();if(i)return i.trim()}return""},e=c([r.RegisterService(i.ServiceType.ContentScriptTools)],e)}();t.ContentScriptTools=o}),r("content-script/services/tools/dom-utils.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.getXPathForElement=function(e){var t=function(e,r){return e?t(e.previousElementSibling,r||e.localName)+(e.localName===r):1},r=function(e){return e&&e.nodeType===Node.ELEMENT_NODE?e.id&&document.querySelector("#"+e.id)===e?['id("'+e.id+'")']:r(e.parentNode).concat([e.localName.toLowerCase()+"["+t(e)+"]"]):[""]};return r(e).join("/")},e=c([r.RegisterService(i.ServiceType.DomUtils)],e)}();t.DomUtils=o}),r("content-script/services/web-request/delegated-web-request-shim.service",["require","exports","common/decorators/index","common/enums/index","content-script/services/index","content-script/content-script.module"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){var e=this;this.apiSupported=!1,this.enabled=!1,this.requestStartListener=function(t){var r=t.detail;r||(r={requestID:"NONE"});var i=[];r.data&&i.push(r.data),e.handleOnBefore(e.instanceInfo.tabId,i,r.requestID)},this.requestEndListener=function(t){var r=t.detail;r||(r={requestID:"NONE"}),e.handleOnCompleted(e.instanceInfo.tabId,r.requestID,r.statusCode)}}return e.prototype.initialize=function(){return s(this,void 0,void 0,function(){var e,t;return a(this,function(r){switch(r.label){case 0:return e=this,[4,o.callBackgroundService(i.ServiceType.WebRequest,"isApiSupported",void 0)];case 1:return e.apiSupported=r.sent(),t=this,[4,o.callBackgroundService(i.ServiceType.WebRequest,"isEnabled",void 0)];case 2:return t.enabled=r.sent(),this.instanceInfo=n.getContentScriptInstanceInfo(),!this.apiSupported&&this.enabled&&(window.addEventListener("lprequeststart",this.requestStartListener),window.addEventListener("lprequestend",this.requestEndListener),window.addEventListener("submit",this.requestStartListener)),[2]}})})},e.prototype.destroy=function(){!this.apiSupported&&this.enabled&&(window.removeEventListener("lprequeststart",this.requestStartListener),window.removeEventListener("lprequestend",this.requestEndListener),window.removeEventListener("submit",this.requestStartListener))},e.prototype.handleOnBefore=function(e,t,r){return e=null==e?this.instanceInfo.tabId:e,o.callBackgroundService(i.ServiceType.WebRequestShim,"handleOnBefore",[e,t,r])},e.prototype.handleOnCompleted=function(e,t,r){return e=null==e?this.instanceInfo.tabId:e,o.callBackgroundService(i.ServiceType.WebRequestShim,"handleOnCompleted",[e,t,r])},e.prototype.handleOnError=function(e,t,r,n){return e=null==e?this.instanceInfo.tabId:e,o.callBackgroundService(i.ServiceType.WebRequestShim,"handleOnError",[e,t,r,n])},e=c([r.RegisterService(i.ServiceType.WebRequestShim,!0)],e)}();t.DelegatedWebRequestShimService=u}),r("content-script/services/web-request/delegated-web-request.service",["require","exports","common/decorators/index","common/enums/index","content-script/services/index"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.apiSupported=!1,this.enabled=!1}return e.prototype.initialize=function(){var e=this;o.callBackgroundService(i.ServiceType.WebRequest,"isApiSupported",void 0).then(function(t){return e.apiSupported=t}),o.callBackgroundService(i.ServiceType.WebRequest,"isEnabled",void 0).then(function(t){return e.enabled=t})},e.prototype.trackFormSubmission=function(e,t,r){return o.callBackgroundService(i.ServiceType.WebRequest,"trackFormSubmission",[e,t,r])},e.prototype.isApiSupported=function(){return this.apiSupported},e.prototype.isEnabled=function(){return this.enabled},e=c([r.RegisterService(i.ServiceType.WebRequest,!0)],e)}();t.DelegatedWebRequestService=n}),r("content-script/services/index",["require","exports","content-script/services/auto-fill/auto-fill.service","content-script/services/form-detection/form-detection.service","content-script/services/segment/delegated-segment.service","content-script/services/service-provider","content-script/services/site/delegated-site.service","content-script/services/tools/content-script-tools.service","content-script/services/tools/dom-utils.service","content-script/services/web-request/delegated-web-request-shim.service","content-script/services/web-request/delegated-web-request.service","common/services/topic/topic.service","common/services/utils/string-utils.service"],function(e,t,r,i,o,n,s,a,c,u,l,p,d){function f(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),f(r),f(i),f(o),f(n),f(s),f(a),f(c),f(u),f(l),f(p),f(d)}),r("content-script/repositories/auto-fill-state/delegated-auto-fill-state.repository",["require","exports","content-script/repositories/index","common/enums/index","common/decorators/index","content-script/content-script.module"],function(e,t,r,i,o,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.prototype.initialize=function(){this.domUtils=n.getService(i.ServiceType.DomUtils)},e.prototype.getState=function(e,t){return r.callBackgroundRepository(i.RepositoryType.AutoFillState,"getState",[null==e?n.getContentScriptInstanceInfo().tabId:e],t)},e.prototype.setState=function(e){r.callBackgroundRepository(i.RepositoryType.AutoFillState,"setState",[e])},e.prototype.deleteState=function(e){r.callBackgroundRepository(i.RepositoryType.AutoFillState,"deleteState",[e])},e.prototype.getFrameAlgorithmState=function(e,t,o,n,s){return o instanceof HTMLElement&&(o=this.domUtils.getXPathForElement(o)),r.callBackgroundRepository(i.RepositoryType.AutoFillState,"getFrameAlgorithmState",this.resolveTargetArgs(e,t).concat([o,n]),s)},e.prototype.setFrameAlgorithmState=function(e,t,o,n,s){o instanceof HTMLElement&&(o=this.domUtils.getXPathForElement(o)),r.callBackgroundRepository(i.RepositoryType.AutoFillState,"setFrameAlgorithmState",this.resolveTargetArgs(e,t).concat([o,n,s]))},e.prototype.setFrameAllowed=function(e,t,o){r.callBackgroundRepository(i.RepositoryType.AutoFillState,"setFrameAllowed",this.resolveTargetArgs(e,t).concat([o]))},e.prototype.setFrameReady=function(e,t,o){r.callBackgroundRepository(i.RepositoryType.AutoFillState,"setFrameReady",this.resolveTargetArgs(e,t).concat([o]))},e.prototype.resetFrameState=function(e,t){r.callBackgroundRepository(i.RepositoryType.AutoFillState,"resetFrameState",this.resolveTargetArgs(e,t).slice())},e.prototype.deleteFrameState=function(e,t){r.callBackgroundRepository(i.RepositoryType.AutoFillState,"deleteFrameState",this.resolveTargetArgs(e,t).slice())},e.prototype.getFillResults=function(e,t,o){return r.callBackgroundRepository(i.RepositoryType.AutoFillState,"getFillResults",this.resolveTargetArgs(e,t).slice(),o)},e.prototype.resolveTargetArgs=function(e,t){var r=n.getContentScriptInstanceInfo(),i=r.tabId,o=r.frameId;return[null==e?i:e,null==t?o:t]},e=c([o.RegisterRepository(i.RepositoryType.AutoFillState,!0)],e)}();t.DelegatedAutoFillStateRepository=s}),r("content-script/repositories/feature/delegated-feature.repository",["require","exports","common/decorators/index","common/enums/index","content-script/legacy"],function(e,t,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.get=function(e){var t=Array.from(arguments);return new Promise(function(e,r){o.LegacyGlobal.bg.LPModule.callRepository(i.RepositoryType.Feature,"get",t,function(t,i){t?r(t):e(i)})})},e.prototype.set=function(e,t){o.LegacyGlobal.bg.LPModule.callRepository(i.RepositoryType.Feature,"set",Array.from(arguments))},e=c([r.RegisterRepository(i.RepositoryType.Feature,!0)],e)}();t.DelegatedFeatureRepository=n}),r("content-script/repositories/repository-provider",["require","exports","common/provider.abstract","content-script/legacy"],function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.queue=[],t}return u(t,e),t.prototype.getRepository=function(e,t){var r,i;if(this.initialized)(i=this.instances[e])||(r="Cannot find repository [ "+e+" ]");else{if(t)return void this.queue.push({repositoryType:e,callback:t});r="Repository provider is undefined."}if(r)throw new Error(r);if(!t)return i;t(null,i)},t.prototype.initialize=function(){for(e.prototype.initialize.call(this);this.queue.length;)try{var t=this.queue.shift(),r=t.repositoryType,i=t.callback;this.getRepository(r,i)}catch(e){console.error(e)}},t.prototype.postInitialize=function(){e.prototype.postInitialize.call(this)},t.prototype.teardown=function(){e.prototype.teardown.call(this)},t}(r.ProviderAbstract);t.RepositoryProvider=o,t.callBackgroundRepository=function(e,t,r,o){if("function"!=typeof o)return new Promise(function(o,n){i.LegacyGlobal.bg.LPModule.callRepository(e,t,r,function(e,t){e?n(e):o(t)})});i.LegacyGlobal.bg.LPModule.callRepository(e,t,r,o)}}),r("content-script/repositories/index",["require","exports","content-script/repositories/auto-fill-state/delegated-auto-fill-state.repository","content-script/repositories/feature/delegated-feature.repository","content-script/repositories/repository-provider"],function(e,t,r,i,o){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(i),n(o)}),r("content-script/views/basic-auth/basic-auth.view",["require","exports","content-script/legacy"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;r.LegacyGlobal.bg.basicAuth.hasFeature(function(t){t&&r.LegacyGlobal.bg.basicAuth.isBasicAuth(function(t,r){return e.init(t,r)})})}return e.prototype.init=function(e,t){var i=this;e&&(this.backgroundInterface=r.LegacyGlobal.bg,this.loadContent(function(){i.initContent(t)}))},e.prototype.loadContent=function(e){var t=this;$.get(chrome.runtime.getURL("/content-script/views/basic-auth/basic-auth.html"),function(r){var i=t.replaceRelativePaths(r);$(document.body).empty().append(i),e()})},e.prototype.initContent=function(e){$("#ba_username").focus(),e||$("#wronguserpass").hide(),document.title="Lastpass basic auth login",$("#title").text(location.host),"http:"===location.protocol?$("#secureWarning").show():$("#secureWarning").hide(),this.subscribeEvents(),this.openPopupNotification(),this.backgroundInterface.sendLpImprove("basicauth::triggered")},e.prototype.subscribeEvents=function(){var e=this;$("#lp-login-btn").click(function(){$(".js-notification").toggle("notification-visible"),e.doLogin()}),$("#password").keypress(function(t){13===t.which&&e.doLogin()}),$("#lp-cancel-btn").click(function(){e.cancelBasicAuth(),e.backgroundInterface.sendLpImprove("basicauth::cancel")}),$(".notification__close__button").click(function(){$(".notification__body").removeClass("slide-in").addClass("slide-out"),e.backgroundInterface.basicAuth.closeNotification()})},e.prototype.doLogin=function(){var e=$("#ba_username").val(),t=$("#ba_password").val();this.backgroundInterface.sendLpImprove("basicauth::login"),this.backgroundInterface.basicAuth.setAuthCredential(e,t,function(){return location.reload()})},e.prototype.cancelBasicAuth=function(){this.backgroundInterface.basicAuth.cancelBasicAuth(),$("#login-body").hide(),location.reload()},e.prototype.replaceRelativePaths=function(e){var t=chrome.runtime.getURL("");return e.replace(new RegExp("{extensionUrl}","g"),t)},e.prototype.openPopupNotification=function(){this.backgroundInterface.basicAuth.isNotificationClosed(function(e){e?$(".notification__body").hide():$(".notification__body").addClass("slide-in")})},e}();t.BasicAuthView=i}),r("content-script/views/index",["require","exports","content-script/views/basic-auth/basic-auth.view"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}),r("content-script/content-script.module",["require","exports","common/enums/index","content-script/repositories/index","content-script/services/index","content-script/views/index","common/module.abstract","common/decorators/index","content-script/legacy"],function(e,t,r,i,o,n,c,l,p){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.requestFrameworkInitialized=new Promise(function(e){p.LegacyGlobal.Topics.get(r.TopicType.RequestFrameworkInitialized).subscribe(function(t){return e(t)})}),window.addEventListener("beforeunload",function(){t.serviceProvider.teardown(),t.repositoryProvider.teardown()}),t}return u(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getContentScriptInstanceInfo=function(){return this.csInfo},t.prototype.initialize=function(){return s(this,void 0,void 0,function(){var e,t,r,n,s;return a(this,function(a){switch(a.label){case 0:return this.serviceProvider=new o.ServiceProvider(l.getServiceRegistry()),this.repositoryProvider=new i.RepositoryProvider(l.getRepositoryRegistry()),[4,this.requestFrameworkInitialized];case 1:return e=a.sent(),t=e.tabID,r=e.frameID,n=e.topFrameID,s=e.request,this.csInfo={tabId:t,frameId:r,topFrameId:n,childFrameCount:s.childFrameCount,isTop:s.top,url:s.url},this.repositoryProvider.initialize(),this.serviceProvider.initialize(),[2]}})})},t.prototype.postInitialize=function(){return s(this,void 0,void 0,function(){return a(this,function(e){return this.repositoryProvider.postInitialize(),this.serviceProvider.postInitialize(),self.basicAuth=new n.BasicAuthView,[2]})})},t.prototype.getServiceProvider=function(){return this.serviceProvider},t.prototype.getRepositoryProvider=function(){return this.repositoryProvider},t.prototype.getService=function(e){if(!this.serviceProvider.isInitialized)throw new Error("Service provider is undefined.");var t=this.serviceProvider.getService(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.prototype.getRepository=function(e){var t=this.repositoryProvider.getRepository(e);if(!t)throw new Error("Cannot find repository [ "+e+" ]");return t},t.prototype.isInitialized=function(t){e.prototype.isInitialized.call(this,t)},t.instance=null,t}(c.ModuleAbstract);t.getContentScriptInstanceInfo=function(){return d.getInstance().getContentScriptInstanceInfo()},t.getService=function(e){return d.getInstance().getService(e)},t.getRepository=function(e){return d.getInstance().getRepository(e)},t.isInitialized=function(e){return d.getInstance().isInitialized(e)},t.callService=function(e,t,r,i){void 0===r&&(r=[]),d.getInstance().getServiceProvider().call(e,t,r,i)},t.default=d.getInstance()}),i.LPModule=t("content-script/content-script.module")}).call(this);
//# sourceMappingURL=sourcemaps/modules-contentscript.js.map
